@startuml IR_Execution
title Alur Eksekusi IR dan DSL Interpreter

skinparam activity {
    BackgroundColor<<ir>> LightYellow
    BackgroundColor<<dsl>> LightCyan
    BackgroundColor<<result>> LightGreen
}

start

partition "AST → IR Generation" <<ir>> {
    :Terima AST dari Parser;
    
    :Generate LOAD_PAYLOAD;
    
    if (AST contains SQLInjectionNode?) then (Ya)
        :Generate CHECK_SQL\n(type, pattern);
        
        if (Severity CRITICAL/HIGH?) then (Ya)
            :Generate BLOCK;
        else (MEDIUM/LOW)
            :Generate ALERT;
        endif
        
        :Generate LOG;
    else (Tidak)
        :Generate ALLOW;
    endif
    
    :Generate HALT;
    
    :Return IR Program;
}

partition "DSL Interpreter" <<dsl>> {
    :Load Signature Rules;
    
    :Compile Regex Patterns;
    
    :Match Payload vs Signatures;
}

partition "IR Execution" <<ir>> {
    :Execute IR Instructions;
    
    :Collect Actions & Output;
}

partition "Result" <<result>> {
    if (Attack Detected?) then (Ya)
        :Response: BLOCK/ALERT;
        :Log Detection Details;
    else (Tidak)
        :Response: ALLOW;
    endif
}

stop

note right
  IR Opcodes:
  ════════════
  LOAD_PAYLOAD
  CHECK_SQL
  BLOCK
  ALERT
  ALLOW
  LOG
  HALT
end note

@enduml
